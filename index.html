<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Liste Anime (CRUD)</title>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    // ‚ö†Ô∏è Mets tes vraies infos Supabase ici
    const supabaseUrl = 'https://ydmqxamsgotncqhqvcgt.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbXF4YW1zZ290bmNxaHF2Y2d0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxNDMyMjAsImV4cCI6MjA3MTcxOTIyMH0.AtUSpfLpklsGzTEKnl2QjKeEcmPNOTEhXiosWivK0Gk'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const tbody = document.querySelector("#dataTable tbody")
    const form = document.getElementById("animeForm")
    const formTitle = document.getElementById("formTitle")

    let editingId = null // savoir si on √©dite ou on ajoute

    // Charger les animes
    async function loadAnimes() {
      const { data, error } = await supabase.from('animes').select('*').order('id', { ascending: false })
      if (error) return console.error(error)

      tbody.innerHTML = ""
      data.forEach(animes => {
        const tr = document.createElement("tr")
        tr.innerHTML = `
          <td>${animes.titre_jp || ''}</td>
          <td>${animes.titre_en || ''}</td>
          <td>${animes.titre_fr || ''}</td>
          <td>${animes.description || ''}</td>
          <td>${animes.description_perso || ''}</td>
          <td>${animes.note || ''}</td>
          <td>${animes.tags ? animes.tags.join(', ') : ''}</td>
          <td>${animes.date || ''}</td>
          <td>
            <button onclick="editAnimes(${animes.id})">‚úèÔ∏è</button>
            <button onclick="deleteAnime(${animes.id})">üóëÔ∏è</button>
          </td>
        `
        tbody.appendChild(tr)
      })
    }

    // Ajouter / Modifier anime
    form.addEventListener("submit", async (e) => {
      e.preventDefault()
      const animes = {
        titre_jp: form.titre_jp.value,
        titre_en: form.titre_en.value,
        titre_fr: form.titre_fr.value,
        description: form.description.value,
        description_perso: form.description_perso.value,
        note: parseFloat(form.note.value) || null,
        tags: form.tags.value.split(',').map(t => t.trim()),
        date: form.date.value || null,
        poster_url: form.poster_url.value
      }

      if (editingId) {
        await supabase.from('animes').update(animes).eq('id', editingId)
        editingId = null
        formTitle.textContent = "Ajouter un anime"
      } else {
        await supabase.from('animes').insert([animes])
      }

      form.reset()
      loadAnimes()
    })

    // Supprimer anime
    window.deleteAnimes = async function(id) {
      if (confirm("Supprimer cet anime ?")) {
        await supabase.from('animes').delete().eq('id', id)
        loadAnimes()
      }
    }

    // √âditer anime
    window.editAnimes = async function(id) {
      const { data } = await supabase.from('animes').select('*').eq('id', id).single()
      if (!data) return
      editingId = id
      formTitle.textContent = "Modifier un anime"
      form.titre_jp.value = data.titre_jp || ''
      form.titre_en.value = data.titre_en || ''
      form.titre_fr.value = data.titre_fr || ''
      form.description.value = data.description || ''
      form.description_perso.value = data.description_perso || ''
      form.note.value = data.note || ''
      form.tags.value = data.tags ? data.tags.join(', ') : ''
      form.date.value = data.date || ''
      form.poster_url.value = data.poster_url || ''
    }

    loadAnimes()
  </script>
</head>
<body>
  <h1 id="formTitle">Ajouter un anime</h1>
  <form id="animeForm">
    <input name="titre_jp" placeholder="Titre JP" required><br>
    <input name="titre_en" placeholder="Titre EN"><br>
    <input name="titre_fr" placeholder="Titre FR"><br>
    <textarea name="description" placeholder="Description"></textarea><br>
    <textarea name="description_perso" placeholder="Description perso"></textarea><br>
    <input name="note" placeholder="Note" type="number" step="0.1"><br>
    <input name="tags" placeholder="Tags (s√©par√©s par virgules)"><br>
    <input name="date" type="date"><br>
    <input name="poster_url" placeholder="Lien image"><br>
    <button type="submit">üíæ Sauvegarder</button>
  </form>

  <h2>Liste des animes</h2>
  <table border="1" id="dataTable">
    <thead>
      <tr>
        <th>Titre JP</th>
        <th>Titre EN</th>
        <th>Titre FR</th>
        <th>Description</th>
        <th>Perso</th>
        <th>Note</th>
        <th>Tags</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</body>
</html>

